ä¸‹é¢æ˜¯ä¸€ä»½**å¯ç›´æ¥äº¤ç»™ codex çš„ã€Šå¼€å‘æŒ‡å¼•ï¼ˆDeveloper Guideï¼‰ã€‹**ã€‚
è¦æ±‚ï¼šå‡¡ä¸ç¬¬ä¸€æ¬¡æ–‡æ¡£æˆ–æœ¬èŠå¤©æœ‰å‡ºå…¥ï¼Œä»¥**è¯¾ç¨‹ PPT**ä¸ºå”¯ä¸€å‡†ç»³ï¼›ç³»ç»Ÿè®¾ç½®å¿…é¡»æŒ‰ PPT é»˜è®¤å€¼å®ç°ï¼Œå¹¶åšæˆå¯é…ç½®é¡¹ã€‚

---

# é…’åº—ä¸­å¤®æ¸©æ§è®¡è´¹ç³»ç»Ÿ Â· å¼€å‘æŒ‡å¼•ï¼ˆä»¥ PPT ä¸ºå‡†ï¼‰

## 0. ç›®æ ‡ä¸èŒƒå›´

* äº¤ä»˜ä¸€ä¸ª**å¯è¿è¡ŒåŸå‹**ï¼ˆåç«¯ API + å‰ç«¯ Webï¼‰è¦†ç›–ï¼š

  1. æˆ¿é—´æ§åˆ¶é¢æ¿ï¼ˆå¼€æœº/è°ƒæ¸©/è°ƒé£/å…³æœº + å®æ—¶çŠ¶æ€ï¼‰ï¼›
  2. å‰å°åŠç†å…¥ä½ï¼›
  3. å‰å°åŠç†ç»“è´¦ï¼ˆç©ºè°ƒè´¦å• + è¯¦å•ï¼‰ï¼›
  4. ç›‘æ§ï¼ˆé€‰åš Bonusï¼‰ï¼›
  5. ç»Ÿè®¡æŠ¥è¡¨ï¼ˆç»ç†æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼‰ã€‚
* **ç³»ç»Ÿè®¾ç½®/è§„åˆ™ä»¥ PPT ä¸ºå‡†**ï¼Œå¹¶å…¨éƒ¨æ”¾å…¥é…ç½®ï¼ˆè§ Â§3.3ï¼‰ã€‚è¦ç‚¹ï¼šæ¸©æ§èŒƒå›´ã€é»˜è®¤æ¸©åº¦ã€è®¡è´¹ä¸èƒ½è€—ã€æ¸©åº¦å˜åŒ–æ¨¡å¼ã€è¯·æ±‚å®šä¹‰ï¼ˆè°ƒé£=æ–°è¯·æ±‚ã€è°ƒæ¸©â‰ æ–°è¯·æ±‚ï¼‰ã€æœåŠ¡èµ„æºä¸Šé™ä¸**ä¼˜å…ˆçº§+æ—¶é—´ç‰‡**è°ƒåº¦ã€è°ƒæ¸©èŠ‚æµï¼ˆ<1s ä»…å–æœ€åä¸€æ¬¡ï¼‰ã€‚
* ç¬¬äºŒæ¬¡ä½œä¸šè¦æ±‚çš„â€œè®¾è®¡å»ºæ¨¡â€å°†å¯ç”±æœ¬å®ç°ä¸€é”®äº§å‡ºæ‰€éœ€ç´ æï¼ˆæ¶æ„/ç•Œé¢/äº¤äº’/ç±»å›¾ï¼‰ã€‚

---

## 1. æŠ€æœ¯é€‰å‹ä¸æ€»ä½“æ¶æ„

### 1.1 æŠ€æœ¯æ ˆ

* **åç«¯**ï¼šPython 3.10+ã€FastAPIã€Uvicornï¼›å†…å­˜å­˜å‚¨èµ·æ­¥ï¼Œå¯åˆ‡æ¢ SQLite + SQLAlchemy/SQLModelï¼›pytest å•æµ‹ã€‚
* **å‰ç«¯**ï¼šReact + Vite + **Tailwind CSS**ï¼ˆä¾¿äºåšâ€œè‹¹æœå®˜ç½‘é£æ ¼â€çš„æç®€ç°ä»£ä¼ä¸šç«™ï¼‰ï¼ŒChart.jsï¼ˆæŠ¥è¡¨ï¼‰ï¼ŒReact Routerã€‚
* **è¿è¡Œ**ï¼šå•ä½“åº”ç”¨ï¼Œå‰åç«¯åˆ†ä»“æˆ–åŒä»“åŒç›®å½•ã€‚

### 1.2 åˆ†å±‚/æ¨¡å—ï¼ˆè½»é‡ DDDï¼‰

```
UIï¼ˆWeb å‰ç«¯ï¼‰
  â””â”€â”€ æ¥å£å±‚ï¼ˆFastAPI routers / DTOï¼‰
        â””â”€â”€ åº”ç”¨å±‚ï¼ˆç”¨ä¾‹æœåŠ¡ï¼šUseACã€CheckInã€CheckOutã€Schedulerã€Billingã€Reportï¼‰
              â””â”€â”€ é¢†åŸŸå±‚ï¼ˆå®ä½“/å€¼å¯¹è±¡ï¼šRoomã€ServiceObjectã€ACBillã€ACDetailRecordã€Queuesâ€¦ï¼‰
                    â””â”€â”€ åŸºç¡€è®¾æ–½å±‚ï¼ˆRepositoryã€å†…å­˜æˆ– SQLiteã€å®šæ—¶/ä»»åŠ¡ï¼‰
```

é¢†åŸŸå¯¹è±¡ã€ç”¨ä¾‹ä¸ä½ ä»¬ä½œä¸š1ä¿æŒä¸€è‡´ï¼ˆè§’è‰²ã€ç”¨ä¾‹ã€è´¦å•/è¯¦å•ã€è°ƒåº¦/é˜Ÿåˆ—ç­‰ï¼‰ï¼Œå‘½åå¯å¤ç”¨ä»¥ä¾¿åç»­â€œä½œä¸š2â€å‡ºå›¾ã€‚

---

## 2. å‰ç«¯ä¿¡æ¯æ¶æ„ä¸é£æ ¼

### 2.1 è·¯ç”±ä¸é¡µé¢

* `GET /` â†’ **å®˜ç½‘ä¸»é¡µï¼ˆHomeï¼‰**ï¼šè‹¹æœé£å¤§å›¾/å¤§æ ‡é¢˜ + åŠŸèƒ½å¡ç‰‡å…¥å£ã€‚
* å­é¡µï¼š

  1. `/room-control/:roomId` **æˆ¿é—´æ§åˆ¶é¢æ¿**ï¼ˆå¿…åšï¼‰
  2. `/checkin` **åŠç†å…¥ä½**ï¼ˆå¿…åšï¼‰
  3. `/checkout` **åŠç†ç»“è´¦**ï¼ˆå¿…åšï¼‰
  4. `/monitor` **ç›‘æ§ç•Œé¢**ï¼ˆé€‰åš Bonusï¼‰
  5. `/report` **ç»Ÿè®¡æŠ¥è¡¨**ï¼ˆç³»ç»Ÿéœ€æ±‚å«æ­¤åŠŸèƒ½ï¼‰

### 2.2 é¡µé¢ç»„æˆï¼ˆç»„ä»¶åŒ–ï¼‰

* **Home**ï¼š`Hero`ï¼ˆå®£è¨€/è¡ŒåŠ¨æŒ‰é’®ï¼‰ + `FeatureCards`ï¼ˆäº”å¡å…¥å£ï¼‰ + `Footer`ï¼ˆç‰ˆæœ¬/å‚æ•°è¯´æ˜ï¼‰ã€‚
* **RoomControlPage**ï¼š`RoomHeader`ï¼ˆæˆ¿å·/çŠ¶æ€ï¼‰/ `TempGauge`ï¼ˆå½“å‰/ç›®æ ‡æ¸©ï¼‰/ `SpeedSelector`ï¼ˆé«˜/ä¸­/ä½ï¼‰/ `FeePanel`ï¼ˆå½“å‰/ç´¯è®¡ï¼‰/ `PowerButtons`ï¼ˆå¼€/å…³ï¼‰ã€‚ï¼ˆç•Œé¢éœ€æ±‚ä¸ PPT/ä½œä¸š1ä¸€è‡´ï¼‰
* **CheckInPage**ï¼š`CustomerForm`/`RoomPicker`ï¼ˆæˆ¿æ€ï¼‰/`DepositPanel`/`CreateOrderResult`ã€‚
* **CheckOutPage**ï¼š`RoomSearch`/`BillsView`ï¼ˆä½å®¿è´¦å•ã€ç©ºè°ƒè´¦å•ã€è¯¦å•ï¼‰/`PayAndPrint`ã€‚
* **MonitorPage**ï¼ˆé€‰åšï¼‰ï¼š`RoomStatusGrid`ï¼ˆæœåŠ¡/ç­‰å¾…/æ¸©åº¦/é£é€Ÿ/è´¹ç”¨ï¼‰æ”¯æŒè‡ªåŠ¨åˆ·æ–°ã€‚
* **ReportPage**ï¼šæ—¶é—´é€‰æ‹©å™¨ + æŒ‡æ ‡å¡ç‰‡ï¼ˆæ”¶å…¥/æ—¶é•¿/é£é€Ÿå æ¯”ï¼‰ + å›¾è¡¨ï¼ˆæŒ‰æˆ¿/æŒ‰æ—¶æ®µï¼‰ + å¯¼å‡º CSVã€‚

### 2.3 â€œè‹¹æœé£â€æ ·å¼è§„èŒƒï¼ˆæ‰§è¡Œè¦ç‚¹ï¼‰

* ç‰ˆå¼ï¼š1280â€“1440 æ …æ ¼ï¼›æ ‡é¢˜ 56â€“72pxï¼›å‰¯æ ‡é¢˜ 24â€“28pxï¼›æ­£æ–‡ 16â€“18pxï¼›**å¤§ç•™ç™½ã€å¼ºå¯¹æ¯”**ã€‚
* è‰²å½©ï¼šå•è‰²åŸºåº• + 1 ä¸ªå¼ºè°ƒè‰²ï¼›æµ…é˜´å½±å¡ç‰‡ï¼›åœ†è§’ 16â€“24ã€‚
* åŠ¨æ•ˆï¼šå¡ç‰‡ hover å¾®ç¼©æ”¾ï¼Œè·¯ç”±æ·¡å…¥æ·¡å‡ºï¼›æŒ‰é’® 150â€“200ms åé¦ˆã€‚
* å¯è¾¾æ€§ï¼šå¯è§çš„èšç„¦æ€ï¼›é”®ç›˜å¯æ“ä½œï¼›â‰¥768/â‰¥1024 ä¸¤æ¡£å“åº”å¼ã€‚

---

## 3. åç«¯è®¾è®¡ä¸ç³»ç»Ÿè®¾ç½®

### 3.1 é¢†åŸŸæ¨¡å‹ï¼ˆå…³é”®å¯¹è±¡ï¼‰

* **Room**ï¼šæˆ¿å·ã€å½“å‰æ¸©åº¦ã€ç›®æ ‡æ¸©åº¦ã€å…¥ä½çŠ¶æ€ã€ç´¯è®¡è´¹ç”¨â€¦
* **ServiceObject**ï¼ˆæœåŠ¡ä¼šè¯ï¼‰ï¼šæˆ¿é—´ã€é£é€Ÿã€å¼€å§‹/ç»“æŸã€ç´¯è®¡æ—¶é•¿ã€çŠ¶æ€ã€‚
* **Queues**ï¼š`ServiceQueue`ï¼ˆæ­£åœ¨æœåŠ¡ï¼‰/ `WaitingQueue`ï¼ˆç­‰å¾…ï¼‰ã€‚
* **ACDetailRecord**ï¼šåŒºé—´ï¼ˆèµ·æ­¢ï¼‰ã€é£é€Ÿã€è´¹ç‡ã€è´¹ç”¨ï¼›**çŠ¶æ€å˜åŒ–å°±â€œç»“è´¦ä¸Šä¸€æ®µâ€æ–°å¼€ä¸€æ®µ**ã€‚
* **ACBill**ï¼šåˆè®¡è´¹ç”¨ + è¯¦å•å…³è”ï¼›**AccommodationOrder/Bill**ï¼šä½å®¿è®¢å•/è´¦å•ã€‚
* **Scheduler**ï¼šç»´æŠ¤é˜Ÿåˆ—ã€æ‰§è¡Œâ€œä¼˜å…ˆçº§ + æ—¶é—´ç‰‡â€ã€‚ï¼ˆä»¥ä¸Šä¸ä½œä¸š1ä¸€è‡´ï¼‰

### 3.2 ç”¨ä¾‹æœåŠ¡ï¼ˆæ–¹æ³•åä¸ SSD/PPT è¯­ä¹‰ä¸€è‡´ï¼‰

* **UseACService**ï¼š
  `power_on(roomId, mode, target_temp, speed)` / `change_temp(roomId, target_temp)` / `change_speed(roomId, speed)` / `power_off(roomId)`

  > **è°ƒé£=æ–°è¯·æ±‚ï¼›è°ƒæ¸©â‰ æ–°è¯·æ±‚**ï¼ˆè§¦å‘è°ƒåº¦ä¸å¦ä»¥ PPT ä¸ºå‡†ï¼‰ã€‚
* **CheckInService**ï¼š`check_in(customer, roomId, nights, deposit)`ï¼ˆåˆ›å»ºä½å®¿è®¢å•/å‘å¡ï¼‰ã€‚
* **CheckOutService**ï¼š`check_out(roomId)`ï¼ˆåˆå¹¶ä½å®¿/ç©ºè°ƒè´¦å•ã€è¯¦å•ã€æ‰“å°/æ”¯ä»˜ï¼‰ã€‚
* **BillingService**ï¼šè¯¦å•èšåˆâ†’ACBillï¼›ä½å®¿è®¡è´¹ï¼›ä¸»è´¦å•ã€‚
* **ReportService**ï¼šæŒ‰æ—¶é—´èŒƒå›´èšåˆç»Ÿè®¡ã€‚

### 3.3 **ç³»ç»Ÿè®¾ç½®ï¼ˆä¸å¾—ç¡¬ç¼–ç ï¼›é»˜è®¤= PPTï¼‰**

```yaml
# backend/app_config.yaml
temperature:
  cool_range: [18, 25]      # åˆ¶å†·
  heat_range: [25, 30]      # åˆ¶çƒ­
  default_target: 25
  idle_drift_per_min: 0.5   # å…³æœºå›åˆå§‹
  mid_delta_per_min: 0.5    # ä¸­é£æ¯åˆ†é’Ÿå˜åŒ–
  high_multiplier: 1.2      # é«˜é£ +20%
  low_multiplier: 0.8       # ä½é£ -20%
billing:
  price_per_unit: 1.0       # å…ƒ/åº¦
  rate_high_unit_per_min: 1.0
  rate_mid_unit_per_min: 0.5
  rate_low_unit_per_min: 0.3333333
scheduling:
  max_concurrent: 3         # yï¼Œé»˜è®¤=3ï¼ˆä¸ä½œä¸š2å»ºæ¨¡ä¸€è‡´ï¼‰
  time_slice_seconds: 60    # sï¼ˆæ—¶é—´ç‰‡ï¼‰
throttle:
  change_temp_ms: 1000      # <1s ä»…é‡‡æœ€åä¸€æ¬¡è°ƒæ¸©
```

ä»¥ä¸Šå„é¡¹å–å€¼ã€è¯­ä¹‰å…¨éƒ¨æ¥è‡ª PPT è¦æ±‚ã€‚

### 3.4 è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰è§„åˆ™ï¼ˆä¸¥æ ¼æŒ‰ PPTï¼‰

* èµ„æºé™åˆ¶ï¼šåŒæ—¶ä»…ä¸º **y** é—´æˆ¿é€é£ï¼ˆx>yï¼‰ã€‚
* ç­–ç•¥ï¼š**ä¼˜å…ˆçº§ï¼ˆæŒ‰é£é€Ÿé«˜>ä¸­>ä½ï¼‰ + æ—¶é—´ç‰‡ï¼ˆs ç§’ï¼‰**ã€‚
* æµç¨‹ï¼ˆæ‘˜å½•è¦ç‚¹ï¼Œå…¨éƒ¨ä»¥ PPT ä¸ºå‡†ï¼‰ï¼š

  1. æœåŠ¡æ•° < y â†’ ç›´æ¥åˆ†é…ï¼›â‰¥y â†’ è¿›å…¥è°ƒåº¦ã€‚
  2. æ–°è¯·æ±‚ä¸æœåŠ¡ä¸­è¯·æ±‚**é£é€Ÿæ¯”è¾ƒ**ï¼š

     * **æ›´é«˜**ï¼šè§¦å‘ä¼˜å…ˆçº§æŠ¢å ï¼ˆPPT 2.1.1 / 2.1.2 / 2.1.3 çš„å¤šç§é‡Šæ”¾/ç­‰å¾… s ç§’è§„åˆ™ï¼‰ã€‚
     * **ç›¸ç­‰**ï¼šæ—¶é—´ç‰‡ï¼›ç­‰å¾… s ç§’åé‡Šæ”¾â€œæœåŠ¡æ—¶é•¿æœ€å¤§â€çš„å¯¹è±¡ç»™ç­‰å¾…è€…ï¼›è‹¥æœŸé—´æœ‰ç©ºé—²åˆ™â€œç­‰å¾…æœ€ä¹…è€…â€å…ˆå¾—ï¼›è‹¥æ›´é«˜é£é€Ÿåˆ°è¾¾ï¼Œç­‰å¾…è€…ç»§ç»­ç­‰ä½†åœ¨åŒé£é€Ÿå†…**ä¼˜å…ˆçº§ä¸Šå‡**ã€‚
     * **æ›´ä½**ï¼šåˆ†é…ç­‰å¾… s ç§’ï¼Œå¾…ç©ºé—²å¹¶å†æ¬¡æ¯”è¾ƒåå¾—åˆ°æœåŠ¡ã€‚

**è¿è¡Œæœºåˆ¶å»ºè®®**ï¼šåç«¯ç”¨ `asyncio` æ¯ç§’ tickï¼šç´¯ç§¯ `served_seconds/waited_seconds`ã€æ¨è¿›æ¸©åº¦æ¨¡å‹ä¸è®¡è´¹ã€æ‰§è¡Œè°ƒåº¦åˆ¤å®šï¼›è¾¾åˆ°ç›®æ ‡æ¸©åº¦è‡ªåŠ¨åœé€é£ï¼Œåç¦»ç›®æ ‡ 1â„ƒ è‡ªåŠ¨é‡å¯ï¼›è°ƒæ¸©å°äº 1s çš„é«˜é¢‘ç‚¹å‡»ä»…é‡‡æœ€åä¸€æ¬¡ã€‚

### 3.5 æ¸©åº¦ä¸è®¡è´¹ï¼ˆä¸¥æ ¼æŒ‰ PPTï¼‰

* æ¸©åº¦å˜åŒ–ï¼šä¸­é£ **0.5â„ƒ/åˆ†**ï¼›é«˜/ä½åˆ†åˆ« **Â±20%**ï¼›å…³æœº **0.5â„ƒ/åˆ†** å›åˆå§‹ã€‚
* è®¡è´¹ï¼š**1å…ƒ/åº¦**ï¼›é«˜/ä¸­/ä½èƒ½è€—é€Ÿç‡åˆ†åˆ« **1/1ã€1/2ã€1/3 åº¦/åˆ†**ï¼›è¯¦å•åœ¨**è°ƒé£/æš‚åœ/å…³æœº**ç­‰çŠ¶æ€åˆ‡æ¢å¤„â€œç»“æ®µâ€ã€‚

---

## 4. API è§„èŒƒï¼ˆå¯ç›´æ¥è½ç ï¼‰

> ç»Ÿä¸€å“åº”ï¼š`{ data, error }`ï¼›é”™è¯¯å« `code/message`ã€‚å­—æ®µå‘½åä¸ SSD/æ“ä½œå¥‘çº¦è¯­ä¹‰ä¸€è‡´ï¼Œä¾¿äºâ€œä½œä¸š2â€å¼•ç”¨ã€‚

### 4.1 æ§åˆ¶é¢æ¿

* **å¼€æœº** `POST /rooms/{id}/ac/power-on`
  Req: `{ "mode":"cool|heat", "targetTemp": number, "speed":"HIGH|MID|LOW" }`
  Res: `{ "status":"SERVING|WAITING", "currentTemp": number, "targetTemp": number, "speed": "...", "currentFee": number, "totalFee": number }`
  è¯´æ˜ï¼š**è°ƒé£=æ–°è¯·æ±‚ï¼›è°ƒæ¸©â‰ æ–°è¯·æ±‚**ï¼ˆè§¦å‘è°ƒåº¦ï¼‰ã€‚
* **è°ƒæ¸©** `POST /rooms/{id}/ac/change-temp` `{ "targetTemp": number }`ï¼ˆ<1s èŠ‚æµï¼‰ â†’ è¿”å›æœ€æ–°çŠ¶æ€ã€‚
* **è°ƒé£** `POST /rooms/{id}/ac/change-speed` `{ "speed":"HIGH|MID|LOW" }` â†’ å¯èƒ½è§¦å‘æŠ¢å /æ—¶é—´ç‰‡ â†’ è¿”å›æ˜¯å¦æŠ¢å /æ’é˜Ÿä¿¡æ¯ã€‚
* **å…³æœº** `POST /rooms/{id}/ac/power-off` â†’ å…³é—­ä¼šè¯ã€ç»“æ¸…å½“å‰è¯¦å•ç‰‡æ®µã€‚
* **çŠ¶æ€** `GET /rooms/{id}/ac/state` â†’ æ¸©åº¦/é£é€Ÿ/çŠ¶æ€/è´¹ç”¨ã€‚

### 4.2 å‰å°

* **åŠç†å…¥ä½** `POST /checkin` `{ customer, roomId, nights, deposit }` â†’ åˆ›å»º**ä½å®¿è®¢å•**/å‘å¡ã€‚
* **åŠç†ç»“è´¦** `POST /checkout` `{ roomId }` â†’ è¿”å›**ä½å®¿è´¦å•/ç©ºè°ƒè´¦å•/ç©ºè°ƒè¯¦å•**ä¸æ€»é¢ï¼›æ”¯æŒæ‰“å°ã€‚
* **æŸ¥è¯¢è´¦å•** `GET /rooms/{id}/bills` â†’ åˆå¹¶è¿”å›ã€‚

### 4.3 ç›‘æ§ä¸æŠ¥è¡¨

* **ç›‘æ§æ€»è§ˆ** `GET /monitor/rooms` â†’ æ¯æˆ¿ï¼šæ˜¯å¦æœåŠ¡/ç­‰å¾…ã€å½“å‰/ç›®æ ‡æ¸©ã€é£é€Ÿã€ç´¯è®¡è´¹ç”¨ã€‚
* **ç»Ÿè®¡æŠ¥è¡¨** `GET /report?from=ISO&to=ISO` â†’ æŒ‡æ ‡èšåˆä¸æ˜ç»†ã€‚

---

## 5. æ•°æ®æ¨¡å‹è‰æ¡ˆï¼ˆåç«¯ï¼‰

> èµ·æ­¥å¯ç”¨å†…å­˜å­˜å‚¨ï¼Œè‹¥è½ DBï¼Œå»ºè®® SQLite + SQLModel/SQLAlchemyï¼Œè¡¨ç»“æ„ä¸ä¸‹åˆ—å®ä½“ä¸€è‡´ã€‚

* `Room { id, status, currentTemp, targetTemp, totalFee, ... }`
* `ServiceObject { id, roomId, speed, startedAt, endedAt?, servedSeconds, status }`
* `ACDetailRecord { id, roomId, startedAt, endedAt, speed, rate, fee }`
* `ACBill { id, roomId, periodFrom, periodTo, totalFee }`
* `AccommodationOrder { id, customerId, roomId, checkInAt, nights, deposit }` / `AccommodationBill { id, roomId, fee }`
* `Queues { serviceQueue:[], waitingQueue:[] }`
  ä¸Šè¿°å‘½å/è¯­ä¹‰ä¸ä½œä¸š1çš„æ¦‚å¿µç±»åŠå¥‘çº¦ä¸€è‡´ï¼Œä¾¿äºâ€œä½œä¸š2â€å¤ç”¨ã€‚

---

## 6. ç›®å½•ç»“æ„ä¸æ–‡ä»¶æ¸…å•

```
project-root/
  backend/
    app/
      app_config.yaml              # ç³»ç»Ÿè®¾ç½®ï¼ˆé»˜è®¤= PPTï¼‰
      main.py                      # FastAPI å…¥å£
      config.py                    # è¯»å–é…ç½®
      domain/
        room.py, service_object.py, bill.py, detail_record.py, queues.py
      application/
        use_ac_service.py, scheduler.py, billing_service.py
        checkin_service.py, checkout_service.py, report_service.py
      interfaces/
        ac_router.py, frontdesk_router.py, monitor_router.py, report_router.py
      infrastructure/
        repository.py, memory_store.py, sqlite_repo.py (optional)
    tests/
      test_scheduler.py, test_billing.py, test_api.py
    docs/
      api.md                       # è¡¥å……æ–‡å­—ç‰ˆæ¥å£ï¼ˆå¯å¼•ç”¨ Swaggerï¼‰
  frontend/
    src/
      pages/
        Home.tsx, RoomControlPage.tsx, CheckInPage.tsx,
        CheckOutPage.tsx, MonitorPage.tsx, ReportPage.tsx
      components/
        Hero.tsx, FeatureCards.tsx, RoomHeader.tsx, TempGauge.tsx,
        SpeedSelector.tsx, FeePanel.tsx, BillsView.tsx, RoomStatusGrid.tsx
      api/
        acClient.ts, frontdeskClient.ts, monitorClient.ts, reportClient.ts
      styles/tokens.css
```

---

## 7. å…³é”®ç®—æ³•ä¸ä¼ªä»£ç 

### 7.1 è°ƒåº¦ï¼ˆä¼˜å…ˆçº§ + æ—¶é—´ç‰‡ï¼‰

```python
def on_request(room_id, speed):
    if len(service_queue) < max_concurrent:
        assign_service(room_id, speed); return

    cmp = compare_speed(speed, min_service_speed())
    if cmp > 0:  # æ›´é«˜ â†’ ä¼˜å…ˆçº§æŠ¢å ï¼ˆæŒ‰ PPT 2.1.1/2/3ï¼‰
        victim = select_victim_by_rules()  # ä½é£/æœåŠ¡æ—¶é•¿æœ€å¤§/æœ€ä½é£é€Ÿ
        preempt(victim, room_id, speed, wait=s)
    elif cmp == 0:  # ç›¸ç­‰ â†’ æ—¶é—´ç‰‡ï¼ˆPPT 2.2ï¼‰
        enqueue_waiting(room_id, speed, wait=s)
    else:  # æ›´ä½
        enqueue_waiting(room_id, speed, wait=s)
```

* åå°æ¯ç§’ `tick()`ï¼šæ¨è¿› `served_seconds/waited_seconds`ï¼›å€’è®¡æ—¶è‡³ 0 è§¦å‘è½®æ¢æˆ–â€œç­‰å¾…æœ€ä¹…è€…å…ˆå¾—â€ç­‰è§„åˆ™ã€‚

### 7.2 æ¸©åº¦/è®¡è´¹æ¨è¿›

```python
def advance_1s(room, session):
    # æ¸©åº¦å˜åŒ–ï¼ˆæŒ‰ä¸­é£0.5â„ƒ/åˆ†ï¼Œé«˜ä½Â±20%ï¼‰
    delta_per_min = 0.5 * speed_multiplier(session.speed)  # é«˜:1.2, ä½:0.8
    room.currentTemp += sign_toward_target(room) * (delta_per_min / 60.0)

    # è®¡è´¹ï¼ˆæŒ‰åº¦*å•ä»·ï¼›é«˜1/1ï¼Œä¸­1/2ï¼Œä½1/3 åº¦/åˆ† â†’ æ¯ç§’æ¢ç®—ï¼‰
    unit_per_min = {HIGH:1.0, MID:0.5, LOW:1/3}[session.speed]
    session.currentFee += (unit_per_min/60.0) * price_per_unit

    # è¾¾ç›®æ ‡ â†’ åœé€é£ï¼›åç¦»â‰¥1â„ƒ â†’ è‡ªåŠ¨é‡å¯
```

å‚æ•°ã€è¾¹ç•Œå…¨éƒ¨æ¥è‡ª PPTã€‚

---

## 8. å‰åç«¯å¯¹æ¥ï¼ˆè¯·æ±‚èŠ‚æµä¸å®æ—¶æ€§ï¼‰

* **è°ƒæ¸©èŠ‚æµ**ï¼šå‰ç«¯å¯¹ `change-temp` åš `<1s` é˜²æŠ–ï¼›åç«¯äºŒæ¬¡ä¿æŠ¤ï¼ˆä»…é‡‡æœ€åä¸€æ¬¡ï¼‰ã€‚
* **å®æ—¶çŠ¶æ€**ï¼šæ§åˆ¶é¢æ¿ä¸ç›‘æ§é¡µä½¿ç”¨**çŸ­è½®è¯¢**ï¼ˆ2â€“3sï¼‰æˆ–ç®€å• WebSocketï¼ˆå¯é€‰ï¼‰åˆ·æ–°å½“å‰æ¸©åº¦/çŠ¶æ€/è´¹ç”¨ã€‚

---

## 9. è¿è¡Œä¸å¼€å‘

### 9.1 åç«¯

```bash
cd backend
python -m venv .venv && source .venv/bin/activate  # Windows ç”¨ .venv\Scripts\activate
pip install fastapi uvicorn pydantic sqlmodel sqlalchemy
uvicorn app.main:app --reload
# Swagger: http://localhost:8000/docs
```

### 9.2 å‰ç«¯

```bash
cd frontend
npm create vite@latest . -- --template react-ts
npm i
npm i -D tailwindcss postcss autoprefixer && npx tailwindcss init -p
npm i chart.js
npm run dev
```

---

## 10. æµ‹è¯•ä¸éªŒæ”¶

### 10.1 æ ¸å¿ƒç”¨ä¾‹éªŒæ”¶ï¼ˆå¿…é¡»æ¼”ç¤ºï¼‰

* **æ§åˆ¶é¢æ¿**ï¼š

  * é«˜é£æ–°è¯·æ±‚èƒ½**æŠ¢å **ä½é£ï¼›åŒé£é€ŸæŒ‰**æ—¶é—´ç‰‡ s** è½®è½¬ï¼›è¾¾ç›®æ ‡**è‡ªåŠ¨åœ**ï¼›åç¦» **1â„ƒ** **è‡ªåŠ¨é‡å¯**ï¼›çŠ¶æ€/è´¹ç”¨å®æ—¶å¯è§ã€‚
* **åŠç†å…¥ä½/ç»“è´¦**ï¼š

  * èƒ½åˆ›å»º**ä½å®¿è®¢å•/å‘å¡**ï¼›ç»“è´¦è¿”å›**ä½å®¿è´¦å•+ç©ºè°ƒè´¦å•+è¯¦å•**å¹¶æ”¯æŒæ‰“å°/å¯¼å‡ºã€‚
* **ç›‘æ§ï¼ˆé€‰åšï¼‰**ï¼š

  * å…¨é‡æˆ¿é—´çš„**æœåŠ¡/ç­‰å¾…**ã€æ¸©åº¦/é£é€Ÿ/è´¹ç”¨å¯è§†åŒ–ã€‚
* **æŠ¥è¡¨**ï¼š

  * æŒ‡å®šæ—¶é—´æ®µæ±‡æ€»ä¸åˆ†é¡¹ç»Ÿè®¡ï¼ˆæ”¶å…¥/æ—¶é•¿/é£é€Ÿå æ¯”ç­‰ï¼‰ã€‚

### 10.2 å•å…ƒæµ‹è¯•å»ºè®®

* `test_scheduler.py`ï¼šè¦†ç›– PPT çš„ 2.1.1/2/3ã€2.2.1/2/3/4 ç­‰åˆ†æ”¯ã€‚
* `test_billing.py`ï¼šè¯¦å•åˆ†æ®µèšåˆä¸è´¦å•é‡‘é¢æ ¡éªŒã€‚
* `test_api.py`ï¼šPowerOn/ChangeTemp/ChangeSpeed/PowerOff/CheckIn/CheckOut æ­£å¸¸/å¼‚å¸¸æµã€‚

---

## 11. ä¸ä½œä¸š2çš„â€œç›´æ¥æ˜ å°„â€

* **ä»»åŠ¡1ï¼ˆæ¡†æ¶ç»“æ„ï¼‰**ï¼šæŒ‰æœ¬åˆ†å±‚ä¸ç›®å½•ç›´æ¥å‡ºå›¾/è¯´æ˜ã€‚
* **ä»»åŠ¡2ï¼ˆç•Œé¢ï¼‰**ï¼šæäº¤ 3ï¼ˆ+1 bonusï¼‰é¡µç•Œé¢åŸå‹/æˆªå›¾ï¼šæ§åˆ¶é¢æ¿ã€å…¥ä½ã€ç»“è´¦ã€ï¼ˆç›‘æ§ï¼‰ã€‚
* **ä»»åŠ¡3ï¼ˆåŠ¨æ€äº¤äº’å›¾ï¼‰**ï¼šåŸºäº APIâ†’Serviceâ†’Scheduler/Billing çš„è°ƒç”¨é“¾ï¼Œä¸º **PowerOn/ChangeTemp/ChangeSpeed/PowerOff** åŠ **Create_*Order/Bill/DetailRecord** é€æ¡ç”»åºåˆ—å›¾ï¼›è¦†ç›–â€œ**ä¸Šé™=3** ä¸”è¯·æ±‚>3â€æ—¶çš„ PPT æ‰€æœ‰åˆ†æ”¯ã€‚
* **ä»»åŠ¡4ï¼ˆé™æ€ç±»å›¾ï¼‰**ï¼šä¸ºâ€œé¡¾å®¢ä½¿ç”¨ç©ºè°ƒâ€â€œåŠç†å…¥ä½/ç»“è´¦â€å„å‡ºä¸€å¼ è®¾è®¡ç±»å›¾ï¼ˆBoundary/Control/Entityï¼‰ã€‚
* **ä»»åŠ¡5ï¼ˆå·¥ä½œé‡è¡¨ï¼‰**ï¼šæŒ‰æ¨¡æ¿å¡«åˆ†å·¥/å·¥æ—¶ã€‚

---

## 12. ä¸€è‡´æ€§çº¦æŸï¼ˆåŠ¡å¿…éµå®ˆï¼‰

1. **ä»»ä½•å®ç°ä¸ PPT å†²çªæ—¶ï¼Œå‡ä»¥ PPT ä¸ºå‡†**ï¼ˆå‚æ•°ã€è§„åˆ™ã€è¾¹ç•Œï¼‰ã€‚
2. **é»˜è®¤èµ„æºä¸Šé™ y=3**ï¼ˆå¯é…ç½®ï¼‰ï¼Œä»¥æ»¡è¶³ä½œä¸šå»ºæ¨¡è¦æ±‚ã€‚
3. **è°ƒé£=æ–°è¯·æ±‚ï¼›è°ƒæ¸©â‰ æ–°è¯·æ±‚**ã€‚
4. **è°ƒæ¸©èŠ‚æµ**ï¼š<1s ä»…é‡‡æœ€åä¸€æ¬¡ï¼Œå‰åç«¯éƒ½è¦è½å®ã€‚

---

## 13. é™„ï¼šåŠŸèƒ½æ¥æºå¯¹ç…§ï¼ˆä¾¿äºæŸ¥è¯ï¼‰

* **ç³»ç»ŸåŠŸèƒ½/è®¾ç½®**ï¼šæ¸©æ§èŒƒå›´ã€é»˜è®¤ 25â„ƒã€è®¡è´¹ä¸èƒ½è€—ã€æ¸©åº¦å˜åŒ–ã€è‡ªåŠ¨åœ/é‡å¯ã€èµ„æºé™åˆ¶ yã€ä¼˜å…ˆçº§+æ—¶é—´ç‰‡è°ƒåº¦ã€è°ƒæ¸©èŠ‚æµ <1sã€‚
* **â€œè°ƒé£=æ–°è¯·æ±‚ï¼›è°ƒæ¸©â‰ æ–°è¯·æ±‚â€**ï¼šæ˜ç¡®å†™åœ¨ PPTã€‚
* **ç›‘æ§ä¸æŠ¥è¡¨**ï¼šPPT åŸºæœ¬éœ€æ±‚ä¸­æ˜ç¡®åŒ…å«ã€‚
* **ä½œä¸š2è¯„åˆ†ç‚¹/ä»»åŠ¡æ¸…å•**ï¼šç•Œé¢ã€äº¤äº’ã€ç±»å›¾ã€æ¡†æ¶ã€ä¸Šé™=3 åˆ†æ”¯ã€‚
* **ä½œä¸š1æ¨¡å‹ä¸å¥‘çº¦**ï¼šè§’è‰²/ç”¨ä¾‹/SSD/å¥‘çº¦ï¼ˆå…¥ä½ã€é€€æˆ¿ã€è´¦å•/è¯¦å•ç­‰ï¼‰ã€‚

---

> **äº¤ä»˜æ–¹å¼**ï¼šcodex æŒ‰æœ¬æŒ‡å¼•åˆå§‹åŒ–ä»“åº“ã€æ­å»ºç›®å½•ä¸é…ç½®ã€å…ˆè·‘é€šâ€œæ§åˆ¶é¢æ¿é—­ç¯â€ï¼Œå†å®ç°å‰å°æµç¨‹ã€ç›‘æ§ä¸æŠ¥è¡¨ï¼›éšåå¯¼å‡ºä½œä¸š2æ‰€éœ€å›¾ç‰‡ä¸è¯´æ˜ã€‚
> **æé†’**ï¼šé»˜è®¤å‚æ•°**å¿…é¡»**ä¸ PPT åŒ¹é…ï¼Œä¸”æ‰€æœ‰æ•°å€¼çš†æ¥è‡ªé…ç½®æ–‡ä»¶ï¼Œä¸å¾—ç¡¬ç¼–ç ã€‚

ï¼ˆå®Œï¼‰

### 3.6 Êı¾İ³Ö¾Ã»¯£¨ĞÂÔö£©

* **SQLite + SQLModel** ×÷ÎªÄ¬ÈÏ´æ´¢²ã£¬`backend/infrastructure/database.py` Ìá¹© Engine + `SessionLocal` ²¢¼¯ÖĞ³õÊ¼»¯½¨±í¡£
* Room¡¢ServiceObject¡¢ACDetailRecord¡¢ACBill¡¢AccommodationOrder/Bill¡¢WaitEntry/ServiceEntry ¾ùĞè½¨±í£¬×Ö¶ÎÓëÁìÓòÄ£ĞÍ±£³ÖÒ»ÖÂ¡£
* `sqlite_repo.py` ÊµÏÖÍ³Ò»²Ö´¢½Ó¿Ú£º`get_room/save_room`¡¢·şÎñ¶ÓÁĞ CRUD¡¢µÈ´ı¶ÓÁĞ CRUD¡¢Ïêµ¥/ÕËµ¥Ğ´Èë¡¢×¡ËŞ¶©µ¥/ÕËµ¥Ğ´Èë£»ËùÓĞ DB ²Ù×÷±ØĞë°ü¹üÔÚ `SessionLocal()` ÊÂÎñÖĞ¡£
* Scheduler `tick_1s()` ÍÆ½øÎÂ¿ØÓë¼Æ·ÑÊ±£¬±ØĞëÊµÊ±µ÷ÓÃ²Ö´¢½Ó¿Ú¸üĞÂ Room/ServiceObject/DetailRecord£¬ÒÔÈ·±£¡°ÎÂ¿Ø + ¼Æ·Ñ¡±ÂäµØÊı¾İ¿â£¬Ç°ºó¶Ë API ½öÍ¨¹ı²Ö´¢·ÃÎÊ×´Ì¬¡£
* ±£Áô InMemory ²Ö´¢ÊµÏÖ£¨½Ó¿ÚÒ»ÖÂ£©£¬±ãÓÚµ¥²â»ò Demo ÇĞ»»£»ÕıÊ½ÔËĞĞÄ¬ÈÏ¼ÓÔØ SQLite ²Ö´¢¡£

